# bevy_virtual_stick (work in progress)

Create and use a virtual touch screen joystick for the
[Bevy](https://bevyengine.org/) game engine.

## Goals

- [x] Support mouse and touch
- [x] Multiple joysticks on screen (for e.g. twin stick)
- [ ] Simple stupid implementation
- [ ] Modular rendering
- [ ] Integration with bevy (`Res<Input<TouchStick>>`)
- [ ] Integration with leafwing input manager

## Examples

- [`simple`](./examples/simple.rs)
- [`multiple`](./examples/multiple.rs)

## Usage

Check out the [examples](./examples) for details.

```sh
cargo run --example simple
```

```rust
use bevy::prelude::*;
use bevy_touch_stick::*;

// Id for joysticks
#[derive(Default, Reflect, Hash, Clone, PartialEq, Eq)]
enum JoystickControllerId {
    #[default]
    Joystick1,
    Joystick2,
}

#[bevy_main]
fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_plugin(VirtualJoystickPlugin::<JoystickControllerId>::default())
        .run()
}
```

Create Joystick

```rust
#[bevy_main]
fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_plugins(VirtualJoystickPlugin)
        .add_systems(Startup, setup)
        .add_systems(Update, update_player)
        .run()
}

fn setup(mut cmd: Commands, asset_server: Res<AssetServer>) {
    cmd.spawn(Camera2dBundle::default());
    cmd.spawn_empty().insert(Player(30.));

    // Spawn Virtual Joystick at horizontal center
    cmd.spawn(
        // Define variable for Joystick
        VirtualJoystickBundle::new(VirtualJoystickNode {
            border_image: asset_server.load("outline.png"),
            knob_image: asset_server.load("knob.png"),
            knob_size: Vec2::new(80., 80.),
            dead_zone: 0.,
            id: JoystickControllerId::Joystick1,
            axis: VirtualJoystickAxis::Horizontal,
            behaviour: VirtualJoystickType::Fixed,
        })
        .set_color(TintColor(Color::WHITE))
        .set_style(Style {
            size: Size::all(Val::Px(150.)),
            position_type: PositionType::Absolute,
            position: UiRect {
                left: Val::Percent(50.),
                bottom: Val::Percent(15.),
                ..default()
            },
            ..default()
        }),
    )
    // When you add this component you mark this area as interactable for Joystick
    .insert(VirtualJoystickInteractionArea);
}
```

Use variable generated by Joystick

```rust

fn update_player(
    mut joystick: EventReader<VirtualJoystickEvent<JoystickControllerId>>,
    mut player: Query<(&mut Transform, &Player)>,
    time_step: Res<FixedTime>,
) {
    // Get player
    let (mut player, player_data) = player.single_mut();

    // Iter each joystick event
    for j in joystick.iter() {
        // get axis value 0-1 in x & y
        let Vec2 { x, y } = j.axis();
        // Verify Id of joystick for movement
        match j.id() {
            JoystickControllerId::Joystick1 => {
                // Move player using joystick axis value
                player.translation.x += x * player_data.0 * time_step.period.as_secs_f32();
                player.translation.y += y * player_data.0 * time_step.period.as_secs_f32();
            }
        }
    }
}
```

## Bevy Version Support

The `main` branch targets the latest bevy release.

|bevy|bevy_touch_stick|
|----|----------------|
|0.11| main           |

## License

`bevy_touch_stick` is dual-licensed under either

- MIT License (./LICENSE-MIT or <http://opensource.org/licenses/MIT>)
- Apache License, Version 2.0 (./LICENSE-APACHE or <http://www.apache.org/licenses/LICENSE-2.0>)

at your option.

## Contributions

PRs welcome!

## Acknowledgements

`bevy_touch_stick` was forked from [`virtual_joystick`](https://github.com/SergioRibera/virtual_joystick)
